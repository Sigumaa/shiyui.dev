---
import type { MarkdownHeading } from 'astro'

import { TOC } from 'astro-pure/components/pages'
import PageLayout from '@/layouts/ContentLayout.astro'
import { integ } from '@/site-config'

// Walineは有効時のみ読み込む（バンドル抑制）
let Comment: any
let PageInfo: any
if (integ.waline.enable) {
  const w = await import('@/components/waline')
  Comment = w.Comment
  PageInfo = w.PageInfo
}

interface Props {
  title: string
  headings?: MarkdownHeading[]
  view?: boolean
  comment?: boolean
}

const { title, headings, view, comment: enableComment, ...props } = Astro.props
---

<PageLayout meta={{ title }} {...props}>
  {headings?.length && <TOC headings={headings} slot='sidebar' />}

  <Fragment slot='header'>
    <h1 class='text-2xl font-medium sm:mb-2 sm:text-3xl'>{title}</h1>
    {(view || enableComment) && integ.waline.enable && PageInfo && (
      <PageInfo {view} comment={enableComment} class='italic' />
    )}
  </Fragment>

  <slot />

  <slot name='bottom' slot='bottom'>
    {enableComment && integ.waline.enable && Comment && <Comment class='mt-3 sm:mt-6' />}
  </slot>

  <slot name='bottom-sidebar' slot='bottom-sidebar' />
</PageLayout>
